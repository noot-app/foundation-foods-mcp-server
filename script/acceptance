#!/usr/bin/env bash

set -euo pipefail

source script/env "$@"

# Parse command line arguments
DEBUG_FLAG=""
for arg in "$@"; do
    case $arg in
        --debug)
            DEBUG_FLAG="--debug"
            shift
            ;;
        --help|-h)
            echo "Usage: $0 [--debug]"
            echo ""
            echo "Options:"
            echo "  --debug    Show JSON responses from MCP server"
            exit 0
            ;;
    esac
done

echo -e "${GREEN}🧪 FoundationFoods MCP Server - Acceptance Tests${OFF}"
echo

# Check if server is running
if ! curl -s -f http://localhost:8080/health > /dev/null 2>&1; then
    echo -e "${RED}❌ Server is not running on localhost:8080${OFF}"
    echo -e "${YELLOW}💡 Please start the server first with: script/server${OFF}"
    exit 1
fi

# Build and run the simple MCP API key authentication test
go run ./test/acceptance/acceptance.go $DEBUG_FLAG

echo
echo -e "${GREEN}🎯 Acceptance tests completed successfully!${OFF}"
